; Edit= 9173 to VERSIO.MAC on 22-Jun-90 by GSCOTT
;Update copyright notice.
; UPD ID= 8639, RIP:<7.MONITOR>VERSIO.MAC.3,  11-Feb-88 18:55:58 by GSCOTT
;TCO 7.1218 - Update copyright date.
; UPD ID= 1, RIP:<7.MONITOR>VERSIO.MAC.2,  18-May-87 15:01:14 by LOMARTIRE
;Fix VEDIT so that it defaults to 0 if it is not defined.
;This is so that the new method for defining VEDIT will work.
;This new system is to define the edit number as the UID.TXT number.
;This is done when the monitors are built via any .CTL in M70:
; UPD ID= 2201, SNARK:<6.1.MONITOR>VERSIO.MAC.597,   5-Jun-85 11:23:13 by MCCOLLUM
;TCO 6.1.1406  - Update copyright notice.
; UPD ID= 1628, SNARK:<6.MONITOR>VERSIO.MAC.736,   7-Jan-83 12:36:29 by MCINTEE
;TCO 6.1445 - ADD SYSJOB
; UPD ID= 240, SNARK:<6.MONITOR>VERSIO.MAC.317,   8-Dec-81 09:40:40 by PAETZOLD
;Fix VEDIT again
; UPD ID= 237, SNARK:<6.MONITOR>VERSIO.MAC.315,   7-Dec-81 09:18:31 by GRANT
;Fix VEDIT symbol
; UPD ID= 1575, SNARK:<6.MONITOR>VERSIO.MAC.5,  24-Feb-81 08:45:27 by GRANT
;UPDATE FOR V6
; UPD ID= 1310, SNARK:<5.MONITOR>VERSIO.MAC.56,  24-Nov-80 17:16:12 by DONAHUE
; UPD ID= 427, SNARK:<5.MONITOR>VERSIO.MAC.2,  10-Apr-80 10:46:14 by LYONS
;UPDATE FOR V5
;<4.1.MONITOR>VERSIO.MAC.930,  7-Nov-79 15:57:55, EDIT BY R.ACE
;NOW CHANGE TSVN AND VTSVN TO READ "4.1" INSTEAD OF "4A"
;ALSO CHANGE NAME OF SETSPD FROM "4A-SETSPD" TO "4-1-SETSPD"
;<4.1.MONITOR>VERSIO.MAC.925,  5-Nov-79 21:20:30, EDIT BY R.ACE
;CHANGE VERSION NUMBER TO 4.1
;<4.MONITOR>VERSIO.MAC.691, 11-Mar-79 13:20:38, EDIT BY KONEN
;UPDATE COPYRIGHT FOR RELEASE 4
;<4.MONITOR>VERSIO.MAC.310, 21-Jul-78 13:38:35, Edit by HELLIWELL
;ALLOW VWHO TO BE SET EXTERNALLY
;<4.MONITOR>VERSIO.MAC.212, 16-May-78 18:08:25, EDIT BY MILLER
;ADD MINOR VERSION TO SETSPD NAME
;<4.MONITOR>VERSIO.MAC.73, 31-Jan-78 15:10:51, Edit by MCLEAN
;CHANGE VERSION NUMBER TO 4

;	COPYRIGHT (c) DIGITAL EQUIPMENT CORPORATION 1976, 1990.
;	ALL RIGHTS RESERVED.
;
;	THIS SOFTWARE IS FURNISHED UNDER A  LICENSE AND MAY BE USED AND  COPIED
;	ONLY IN  ACCORDANCE  WITH  THE  TERMS OF  SUCH  LICENSE  AND  WITH  THE
;	INCLUSION OF THE ABOVE  COPYRIGHT NOTICE.  THIS  SOFTWARE OR ANY  OTHER
;	COPIES THEREOF MAY NOT BE PROVIDED  OR OTHERWISE MADE AVAILABLE TO  ANY
;	OTHER PERSON.  NO  TITLE TO  AND OWNERSHIP  OF THE  SOFTWARE IS  HEREBY
;	TRANSFERRED.
;
;	THE INFORMATION IN THIS  SOFTWARE IS SUBJECT  TO CHANGE WITHOUT  NOTICE
;	AND SHOULD  NOT  BE CONSTRUED  AS  A COMMITMENT  BY  DIGITAL  EQUIPMENT
;	CORPORATION.
;
;	DIGITAL ASSUMES NO  RESPONSIBILITY FOR  THE USE OR  RELIABILITY OF  ITS
;	SOFTWARE ON EQUIPMENT THAT IS NOT SUPPLIED BY DIGITAL.


	TITLE VERSIO - MONITOR VERSION NUMBER AND NAME MODULE
	SEARCH PROLOG,MACSYM
	.CPYRT (1990)		;[7.1218] 

                                ;Note that edit # is set by .CTL file.
IFNDEF VEDIT,<VEDIT==0>		;The edit number is equal to UID.TXT.
VMAJOR==7
VMINOR==0
IFNDEF VWHO,<VWHO==0>
SCVN==<VWHO>B2+<VMAJOR>B11+<VMINOR>B17+VEDIT

;THE FOLLOWING MACRO GENERATES THE STRING:
;
;DEFINE SETVER(FOO)
;<FOO(WX(Y)-Z)
;>
;
;THE W,X,Y,Z ARE CALCULATED BY THE MACRO LIKE THIS:

;W - THE NUMBERICAL VALUE OF VMAJOR
;
;X - THE LETTER CORRESPONDING TO THE VALUE OF VMINOR.  @=0, A=1...
;
;Y - THE NUMERICAL VALUE OF VEDIT
;
;Z - THE NUMERICAL VALUE OF VWHO

	DEFINE	.CLNAM<
	  DEFINE  .CLNM(MINOR,WHO)<
	    IFE VMINOR,<
	      IFE VWHO,< .NAME(\VMAJOR,,\VEDIT,)>
	      IFN VWHO,< .NAME(\VMAJOR,,\VEDIT,-WHO)>>
	    IFN VMINOR,<
	      IFE VWHO,< .NAME(\VMAJOR,<.>MINOR,\VEDIT,)>
	      IFN VWHO,< .NAME(\VMAJOR,<.>MINOR,\VEDIT,-WHO)>>>
	IFGE VMINOR-^D64,< VMINOR==0
	  PRINTX %MINOR VERSION TOO LARGE - IGNORED>
	IFGE VWHO-^D8,< VWHO== 0
	  PRINTX %VWHO IS TOO LARGE - IGNORED>
	.CLNM(\VMINOR,\VWHO)
>


;NOW DEFINE A .NAME MACRO TO MAKE A MACRO

	DEFINE	.NAME(V,M,E,W)<
DEFINE SETVER(FOO)
<FOO(<V'M'('E')'W>)
>>

;USE  IT!

.CLNAM

;MACRO TO BUILD VERSION TEXT

   IFNDEF SETV1,<
DEFINE SETV1 (VTXT)<
   DEFINE SYSTXT (FOO)<
	FOO <TOPS-20 System, TOPS-20 Monitor VTXT>>>>

	.PSECT NRCOD		;INCLUDE WITH SWAPPABLE CODE


;SYSTEM VERSION TEXT

SETVER (SETV1)			;GET SYSTXT DEFINED
DEFINE SETV2 (VTXT) <
   DEFINE SYSTXT (FOO)<
      FOO <, TOPS-20 Monitor VTXT>>>	;MACRO TO AID IN GENERATION OF VERSION #
				; PORTION OF MONITOR NAME ONLY


DEFINE FOO (A)<
	ASCIZ @A@>

TSVN::	SYSTXT (FOO)
	0			;ROOM FOR PATCHES
TSVNT==:.-TSVN			;LENGTH OF TSVN IN WORDS

SVNM=:SCVN			;DEFINE COMPOSITE VERSION NUMBER

	SETVER (SETV2)		;REDEFINE SYSTXT
VTSVN::	SYSTXT (FOO)		;GENERATE STRING OF JUST THE VERSION
VTSVNT==:.-VTSVN		;NO. OF WORDS IN STRING
;GENERATE ASCIZ NAME OF SETSPD OR SYSJOB

;EXAMPLES:  VERSION 4:	   SYSTEM:4-SETSPD.EXE
;	    VERSION 4.1:   SYSTEM:4-1-SETSPD.EXE

DEFINE BSETSPD (R,R1,NAME)<
	IFE VMINOR,<
	  ASCIZ/SYSTEM:'R'-NAME/>
	IFG VMINOR,<
	  ASCIZ/SYSTEM:'R'-'R1'-NAME/>
	> ;END DEFINE BSETSPD

SETSPD::BSETSPD (\VMAJOR,\VMINOR,SETSPD.EXE)
SYSJOB::BSETSPD (\VMAJOR,\VMINOR,SYSJOB.EXE)

;PUT NUMERICAL FORM OF VERSION NUMBER IN .JBVER (137)

	.ENDPS NRCOD
	LOC 137			;PUT IN STANDARD PLACE
	SCVN

	END
